/**************************************************************************************************
 * project
 * Description - Sys9806 - Site Running Test
 *	- Generated by Source Generator
 *************************************************************************************************/
package project.app.sys.sysItSupport.sysSiteRunningTest;

import java.net.HttpURLConnection;
import java.net.URL;

import project.common.extend.BaseBiz;
import zebra.data.DataSet;
import zebra.data.ParamEntity;
import zebra.exception.FrameworkException;
import zebra.util.CommonUtil;
import zebra.util.ConfigUtil;

public class SysSiteRunningTestBizImpl extends BaseBiz implements SysSiteRunningTestBiz {
	public ParamEntity getDefault(ParamEntity paramEntity) throws Exception {
		try {
			paramEntity.setSuccess(true);
		} catch (Exception ex) {
			throw new FrameworkException(paramEntity, ex);
		}
		return paramEntity;
	}

	public ParamEntity doSearch(ParamEntity paramEntity) throws Exception {
		DataSet ds = new DataSet();
		String header[] = new String[] {"Name", "Url", "Description", "ResponseCode", "Status", "Time"};
		String dateFormat = ConfigUtil.getProperty("format.dateTime.java");
		String status = "", responseCode = "", statusString = "";

		try {
			ds.addName(header);

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "PERCI_LIVE");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://172.16.150.22:8080/perci");
			ds.setValue(ds.getRowCnt()-1, "Description", "PERCI Live");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "PERCI_TEST");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://192.168.10.7:8893/perci_test");
			ds.setValue(ds.getRowCnt()-1, "Description", "PERCI Test");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "PERCI_UAT");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://192.168.10.7:8894/perci_uat");
			ds.setValue(ds.getRowCnt()-1, "Description", "PERCI UAT");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "MERLIN_LIVE");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://172.16.150.5:8090/jasperserver");
			ds.setValue(ds.getRowCnt()-1, "Description", "MERLIN Live");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "MERLIN_TEST");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://172.16.150.15:8080/jasperserver");
			ds.setValue(ds.getRowCnt()-1, "Description", "MERLIN Test");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "WSO2_LIVE");
			ds.setValue(ds.getRowCnt()-1, "Url", "https://192.168.10.10/carbon");
			ds.setValue(ds.getRowCnt()-1, "Description", "WSO2 Live");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "WebCenter_LIVE");
			ds.setValue(ds.getRowCnt()-1, "Url", "https://portal.entitysolutions.com.au/webcenter/portal");
			ds.setValue(ds.getRowCnt()-1, "Description", "WebCenter Live");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "WebCenter_TEST");
			ds.setValue(ds.getRowCnt()-1, "Url", "https://192.168.1.9:7002/em");
			ds.setValue(ds.getRowCnt()-1, "Description", "WebCenter Test");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "JIRA");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://172.16.150.3:8080");
			ds.setValue(ds.getRowCnt()-1, "Description", "JIRA");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			ds.addRow();
			ds.setValue(ds.getRowCnt()-1, "Name", "Wiki");
			ds.setValue(ds.getRowCnt()-1, "Url", "http://172.16.150.3:8090");
			ds.setValue(ds.getRowCnt()-1, "Description", "Wiki");
			status = getSiteRunningStatus(ds.getValue(ds.getRowCnt()-1, "Url"));
			if (CommonUtil.contains(status, ":")) {
				responseCode = CommonUtil.splitWithTrim(status, ":")[0];
				statusString = CommonUtil.splitWithTrim(status, ":")[1];
			} else {
				statusString = CommonUtil.splitWithTrim(status, ":")[0];
			}
			ds.setValue(ds.getRowCnt()-1, "ResponseCode", responseCode);
			ds.setValue(ds.getRowCnt()-1, "Status", statusString);
			ds.setValue(ds.getRowCnt()-1, "Time", CommonUtil.getSysdate(dateFormat));

			paramEntity.setAjaxResponseDataSet(ds);
			paramEntity.setTotalResultRows(ds.getRowCnt());
			paramEntity.setSuccess(true);
		} catch (Exception ex) {
			throw new FrameworkException(paramEntity, ex);
		}
		return paramEntity;
	}

	private String getSiteRunningStatus(String url) {
		HttpURLConnection conn = null;
		int responseCode = -1;

		try {
			conn = (HttpURLConnection)new URL(url).openConnection();

			conn.setRequestMethod("HEAD");
			responseCode = conn.getResponseCode();

			if (responseCode == HttpURLConnection.HTTP_OK) {
				return responseCode+" : "+"Running OK";
			}
			return responseCode+" : "+conn.getResponseMessage();
		} catch (Exception e) {
			return responseCode+" : "+e.getMessage();
		} finally {
			if (conn != null) {conn.disconnect();}
		}
	}
}